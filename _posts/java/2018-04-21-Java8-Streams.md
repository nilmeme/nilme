---
layout: single
title: Java8-Streams
date: 2018-03-09 19:39:43
category: java
toc: true
---

让我们再重新认识一下 **Streams** ，重新思考到底什么是 **Streams**。

1. **Streams** 是可以预测的函数的数据管道
2. 流可以转换数据
3. 流不是数据结构
4. 流不能改变数据

<!--more-->

**Streams** 流不是数据结构，这一点非常重要。我们通常会从一个集合创建一个 **Streams** ，**Streams** 是可以应用于数据上的可预测的函数，但流本身不是数据结构。重要的话再说一边，流不是数据结构！一个 **Streams** 由多个函数组成，这些函数就是处理数据的流水线，而且函数的处理结果不会改变数据结构。但是，数据可以被转换并且之后存储在另一个数据结构中或者可能被另一个函数使用。

**Streams** 可以很形象的看成是数据流水线。流水线中被区分出两类，一类是数据操作流水线（中间操作），一类是数据最后的输出（终端操作），输出后这条流水线的工作也就结束了。

就好比现在有一块铁皮上了一条加工流水线，有打孔的操作，有冲压的操作，有上漆的操作等等，最后再经过最终打包离开流水线。

### 中间操作

每个中间操作总是被懒惰地执行。也就是说，在达到终端操作的时候它们不会运行。我们现在开始更深入地了解 **Streams** 中最常用的中间操作。

1. filter - 过滤器会对数据进行塞选。过滤器之前和之后的元素本身将具有相同的类型，但元素的数量可能会发生变化。
2. map - 映射之前和之后的元素可能具有不同的类型，但会有相同的元素总数。
3. distinct - distinct 是过滤器操作的一个特例。 **Distinct** 基于元素的 **equals** 方法返回一个新的元素流，使得每个元素在流中都是唯一的。

下面是一个总结这一点的表格，包括其他一些常见的中间操作。

| 方法 | 数量改变 | 类型改变 | 排序改变 |
| - | - | - | - |
| map | ✓ | x | ✓ |
| filter | x | ✓ | ✓ |
| distinct | x | ✓ | ✓ |
| sorted | ✓ | ✓ | x |
| peek | ✓ | ✓ | ✓ |


### 终端操作

终端操和中间操作不同，它会被立即执行。该操作将启动流中存在的所有先前惰性操作的执行。 终端操作要么返回具体的类型，要么执行一个操作。

例如，一个调用 **Integer::sum** 的操作会产生一个Optional，它是一个具体类型。

又或者，**forEach** 操作不会返回具体类型，但可以执行一个方法，如打印每个元素。

**collect** 操作也是一种特殊的操作，它从流中获取所有元素并生成一个Set，Map或List。


### Stream 例子

现在来看几个例子，看看我们简单的开始使用 **Streams** 操作。

首先我们先创建两个类 **Book** 和 **Author** ，每本书有一个作者，实例化多本数，最后把这些书放到一个叫library的数组里。

例1：获得50岁或以上的前15位书籍作者的姓名，并将作者的姓名改为大写。

```java
library.stream()
          .map(book -> book.getAuthor())
          .filter(author -> author.getAge() >= 50)
          .map(Author::getSurname)
          .map(String::toUpperCase)
          .distinct()
          .limit(15)
          .collect(toList()));
```

你有没有注意到，当我们通读代码时，我们可以逐行描述它正在做什么。想象一下，如果你用原来的处理方式要怎么处理。

例2：打印所有年龄小于25岁的女性作者的年龄总和。

```java
library.stream()
          .map(Book::getAuthor)
          .filter(author -> author.getGender() == Gender.FEMALE)
          .map(Author::getAge)
          .filter(age -> age < 25)
          .reduce(0, Integer::sum)
```

使用相同的library，我们再次将书籍中的元素映射到作者，并仅对那些女性作者进行过滤。接下来我们将作者中的元素映射到作者年龄，这给了我们一个整数。 我们将年龄过滤到仅少于25的年龄，并使用 *reduce* 和 **Integer::sum** 来累计年龄。

### parallelStream

**parallelStream** 它通过默认的ForkJoinPool,可能提高你的多线程任务的速度.

什么是 **parallelStream** ，我们会在单独的一片文章中详细讲解
